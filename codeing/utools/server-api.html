<!doctype html><html data-theme="light" lang="zh-CN"><head> <meta charset="UTF-8"> <meta content="width=device-width,initial-scale=1" name="viewport"> <title>ABlog</title> <link href="../../logo.svg" rel="icon" type="image/x-icon"> <link href="../../normalize.css" rel="stylesheet"> <link href="../../github-markdown.css" rel="stylesheet"> <link href="../../github-alert.css" rel="stylesheet"> <link href="../../hljs.css" rel="stylesheet"> <link href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" rel="stylesheet" crossorigin="anonymous" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+"> <link href="../../index.css" rel="stylesheet"> <meta content="ABlog 是一个高性能的文档生成器" name="description"> <meta content="ABlog,文档生成器,markdown,md,html,markdown转html,md2html,blog" name="keywords"> </head> <body> <header id="header-box"> <svg class="menu-btn" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"> <title>菜单</title> <path d="M3 4h18v2H3zm0 7h18v2H3zm0 7h18v2H3z" fill="currentColor"></path> </svg> <h1 id="header"><a href="../../index.html">ABlog</a></h1> <div class="github"> <a href="https://github.com/share121/ablog" target="_blank">Github</a> </div> <svg class="random-btn" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"> <title>文章漫游</title> <path d="M5 5v14h14V5zM3 5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2zm12.5 12a1.5 1.5 0 1 0 0-3a1.5 1.5 0 0 0 0 3M10 8.5a1.5 1.5 0 1 1-3 0a1.5 1.5 0 0 1 3 0m2 5a1.5 1.5 0 1 0 0-3a1.5 1.5 0 0 0 0 3" fill="currentColor"></path> </svg> <svg class="theme-switch sun" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"> <title>切换到深色模式</title> <path d="M12 18a6 6 0 1 1 0-12a6 6 0 0 1 0 12m0-2a4 4 0 1 0 0-8a4 4 0 0 0 0 8M11 1h2v3h-2zm0 19h2v3h-2zM3.515 4.929l1.414-1.414L7.05 5.636L5.636 7.05zM16.95 18.364l1.414-1.414l2.121 2.121l-1.414 1.414zm2.121-14.85l1.414 1.415l-2.121 2.121l-1.414-1.414zM5.636 16.95l1.414 1.414l-2.121 2.121l-1.414-1.414zM23 11v2h-3v-2zM4 11v2H1v-2z" fill="currentColor"></path> </svg> <svg class="theme-switch moon" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"> <title>切换到浅色模式</title> <path d="M10 7a7 7 0 0 0 12 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12S6.477 2 12 2h.1A6.98 6.98 0 0 0 10 7m-6 5a8 8 0 0 0 15.062 3.762A9 9 0 0 1 8.238 4.938A8 8 0 0 0 4 12" fill="currentColor"></path> </svg> </header> <div class="markdown-body" id="app"> <aside id="content"><ul><li><a href="../../grammar.html">语法</a></li><li><a href="../../second.html">第二个页面</a></li><li><a href="../../chinese/index.html">语文</a><ul><li><a href="../../chinese/梦想励志类作文.html">梦想励志类作文</a></li><li><a href="../../chinese/议论文作文.html">议论文作文</a></li><li><a href="../../chinese/真情作文.html">真情作文</a></li><li><a href="../../chinese/书体特点.html">书体特点</a></li></ul></li><li><a href="../../math/index.html">数学</a><ul><li><a href="../../math/相似三角形.html">相似三角形</a></li><li><a href="../../math/圆.html">圆</a></li><li><a href="../../math/二次函数.html">二次函数</a></li><li><a href="../../math/反比例函数.html">反比例函数</a></li></ul></li><li><a href="../../english/index.html">英语</a><ul><li><a href="../../english/定语从句.html">定语从句</a></li><li><a href="../../english/开学考笔记.html">开学考笔记</a></li><li><a href="../../english/student-times/index.html">周报</a><ul><li><a href="../../english/student-times/01.html">01</a></li><li><a href="../../english/student-times/02.html">02</a></li><li><a href="../../english/student-times/05.html">05</a></li></ul></li><li><a href="../../english/fit-english/index.html">沸腾英语</a><ul><li><a href="../../english/fit-english/06.html">06</a></li></ul></li></ul></li><li><a href="../../politics/index.html">政治</a><ul><li><a href="../../politics/九上政治提纲.html">九上政治提纲</a></li></ul></li><li><a href="../../history/index.html">历史</a><ul><li><a href="../../history/八年级下册/index.html">八年级下册</a><ul><li><a href="../../history/八年级下册/中华人民共和国成立.html">中华人民共和国成立</a></li><li><a href="../../history/八年级下册/抗美援朝.html">抗美援朝</a></li><li><a href="../../history/八年级下册/土地改革.html">土地改革</a></li><li><a href="../../history/八年级下册/新中国工业化的起步和人民代表大会制度的确立.html">新中国工业化的起步和人民代表大会制度的确立</a></li><li><a href="../../history/八年级下册/三大改造.html">三大改造</a></li><li><a href="../../history/八年级下册/艰辛探索与建设成就.html">艰辛探索与建设成就</a></li><li><a href="../../history/八年级下册/伟大的历史转折.html">伟大的历史转折</a></li><li><a href="../../history/八年级下册/经济体制改革.html">经济体制改革</a></li></ul></li></ul></li><li><a href="../../physics/index.html">物理</a><ul><li><a href="../../physics/分子热运动.html">分子热运动</a></li><li><a href="../../physics/内能.html">内能</a></li></ul></li><li><a href="../../chemistry/index.html">化学</a><ul><li><a href="../../chemistry/初识化学.html">初识化学</a></li><li><a href="../../chemistry/走进化学实验室.html">走进化学实验室</a></li><li><a href="../../chemistry/实验探究初步.html">实验探究初步</a></li><li><a href="../../chemistry/空气和氧气.html">空气和氧气</a></li><li><a href="../../chemistry/氧气的制备综合.html">氧气的制备综合</a></li><li><a href="../../chemistry/物质的变化和性质.html">物质的变化和性质</a></li><li><a href="../../chemistry/化学常用知识.html">化学常用知识</a></li></ul></li><li><a href="../../codeing/index.html">编程</a><ul><li><a href="../../codeing/html/index.html">HTML</a><ul><li><a href="../../codeing/html/HTML 语法.html">HTML 语法</a></li></ul></li><li><a href="../../codeing/javascript/index.html">JavaScript</a><ul><li><a href="../../codeing/javascript/scope 伪类.html">scope 伪类</a></li><li><a href="../../codeing/javascript/观察元素更改.html">观察元素更改</a></li><li><a href="../../codeing/javascript/修改文件访问时间、修改时间.html">修改文件访问时间、修改时间</a></li><li><a href="../../codeing/javascript/获得所有文件.html">获得所有文件</a></li><li><a href="../../codeing/javascript/获得数据类型.html">获得数据类型</a></li><li><a href="../../codeing/javascript/判断字体是否可用.html">判断字体是否可用</a></li><li><a href="../../codeing/javascript/统计中文.html">统计中文</a></li></ul></li><li><a href="../../codeing/crack/index.html">逆向</a><ul><li><a href="../../codeing/crack/无限 debugger.html">无限 debugger</a></li><li><a href="../../codeing/crack/模拟输入.html">模拟输入</a></li><li><a href="../../codeing/crack/防止强制跳转.html">防止强制跳转</a></li></ul></li><li><a href="../../codeing/python/index.html">Python</a><ul><li><a href="../../codeing/python/后台操作键鼠.html">后台操作键鼠</a></li><li><a href="../../codeing/python/OpenCV.html">OpenCV</a></li><li><a href="../../codeing/python/OpenCV_files/index.html">OpenCV_files</a><ul></ul></li></ul></li><li><a href="../../codeing/dart/index.html">Dart</a><ul><li><a href="../../codeing/dart/线程管理.html">线程管理</a></li><li><a href="../../codeing/dart/字符分割.html">字符分割</a></li></ul></li><li><a href="../../codeing/nuxtjs/index.html">NuxtJS</a><ul><li><a href="../../codeing/nuxtjs/启动项目.html">启动项目</a></li></ul></li><li><a href="../../codeing/solidjs/index.html">SolidJS</a><ul><li><a href="../../codeing/solidjs/why-solid.html">为什么选择 Solid</a></li><li><a href="../../codeing/solidjs/solid-primitives.html">Solid 基石</a></li><li><a href="../../codeing/solidjs/typescript-for-solid.html">Solid 的 TypeScript 语法</a></li></ul></li><li><a href="../../codeing/cpp/index.html">C++</a><ul><li><a href="../../codeing/cpp/basic-concepts/index.html">基本语法</a><ul><li><a href="../../codeing/cpp/basic-concepts/concepts.html">basic</a></li><li><a href="../../codeing/cpp/basic-concepts/comment.html">comment</a></li><li><a href="../../codeing/cpp/basic-concepts/ascii.html">ascii</a></li><li><a href="../../codeing/cpp/basic-concepts/punctuators.html">punctuators</a></li><li><a href="../../codeing/cpp/basic-concepts/identifiers.html">identifiers</a></li></ul></li></ul></li><li><a href="../../codeing/utools/index.html">utools</a><ul><li><a href="../../codeing/utools/welcome.html">welcome</a></li><li><a href="../../codeing/utools/config.html">config</a></li><li><a href="../../codeing/utools/preload.html">preload</a></li><li><a href="../../codeing/utools/template.html">template</a></li><li><a href="../../codeing/utools/api.html">api</a></li><li><a href="../../codeing/utools/db.html">db</a></li><li><a href="../../codeing/utools/ubrowser.html">ubrowser</a></li><li><a href="../../codeing/utools/server-api.html">server-api</a></li><li><a href="../../codeing/utools/payment.html">payment</a></li><li><a href="../../codeing/utools/best.html">best</a></li></ul></li><li><a href="../../codeing/大师课/index.html">大师课</a><ul><li><a href="../../codeing/大师课/原理 事件循环.html">原理 事件循环</a></li><li><a href="../../codeing/大师课/原理 浏览器渲染原理.html">原理 浏览器渲染原理</a></li><li><a href="../../codeing/大师课/实战 歌词滚动效果.html">实战 歌词滚动效果</a></li><li><a href="../../codeing/大师课/实战 购物车效果.html">实战 购物车效果</a></li><li><a href="../../codeing/大师课/知识 属性描述符.html">知识 属性描述符</a></li><li><a href="../../codeing/大师课/框架 Vue 从入门到手撕.html">框架 Vue 从入门到手撕</a></li></ul></li><li><a href="../../codeing/dart-tutorials/index.html">Dart 教程</a><ul><li><a href="../../codeing/dart-tutorials/variables.html">variables</a></li><li><a href="../../codeing/dart-tutorials/operators.html">operators</a></li></ul></li></ul></li><li><a href="../../technology/index.html">科技</a><ul><li><a href="../../technology/单文件制作/index.html">单文件制作</a><ul></ul></li><li><a href="../../technology/白嫖 Office 365/index.html">白嫖 Office 365</a><ul></ul></li><li><a href="../../technology/mp4-to-m3u8.html">mp4-to-m3u8</a></li><li><a href="../../technology/win11-concept-cursor/index.html">win11-concept-cursor</a><ul></ul></li><li><a href="../../technology/fira-code-font-download/index.html">fira-code-font-download</a><ul></ul></li><li><a href="../../technology/free-music/index.html">free-music</a><ul></ul></li><li><a href="../../technology/fast-download.html">fast-download</a></li><li><a href="../../technology/fiddler.html">fiddler</a></li><li><a href="../../technology/share-fanyi.html">share-fanyi</a></li><li><a href="../../technology/misans-font-download.html">misans-font-download</a></li><li><a href="../../technology/update-chrome-plugin.html">update-chrome-plugin</a></li></ul></li><li><a href="../../团校笔记/index.html">团校笔记</a><ul><li><a href="../../团校笔记/01.html">01</a></li><li><a href="../../团校笔记/02.html">02</a></li><li><a href="../../团校笔记/03.html">03</a></li><li><a href="../../团校笔记/04.html">04</a></li><li><a href="../../团校笔记/05.html">05</a></li><li><a href="../../团校笔记/06.html">06</a></li><li><a href="../../团校笔记/07.html">07</a></li></ul></li><li><a href="../../信息技术/index.html">信息技术</a><ul><li><a href="../../信息技术/动画制作初步.html">动画制作初步</a></li><li><a href="../../信息技术/信息与信息处理.html">信息与信息处理</a></li><li><a href="../../信息技术/数据的分析与处理.html">数据的分析与处理</a></li><li><a href="../../信息技术/制作多媒体作品.html">制作多媒体作品</a></li><li><a href="../../信息技术/程序设计初步.html">程序设计初步</a></li><li><a href="../../信息技术/网络基础及应用.html">网络基础及应用</a></li><li><a href="../../信息技术/App Inventor 手机积木式编程.html">App Inventor 手机积木式编程</a></li></ul></li><li><a href="../../大师课/index.html">大师课</a><ul><li><a href="../../大师课/原理-事件循环.html">原理-事件循环</a></li></ul></li></ul></aside> <main class="markdown-body" id="main"> <h1 id="utools-server-api" tabindex="-1">uTools Server API <a href="#utools-server-api" class="header-anchor">#</a></h1> <p>通过 uTools 的服务端 API，可以将你的应用和 uTools 用户关联，实现帐号互通、接收支付通知、查询用户支付记录等，为保护密钥安全，请仅在服务端调用接口。</p> <h2 id="获取用户基础信息接口" tabindex="-1">获取用户基础信息接口 <a href="#获取用户基础信息接口" class="header-anchor">#</a></h2> <p>此接口用于获取 uTools 用户的基础信息、验证用户真实性，与第三方系统进行帐号打通，实现系统间免登录跳转等。</p> <h3 id="11-接口说明" tabindex="-1">1.1 接口说明 <a href="#11-接口说明" class="header-anchor">#</a></h3> <p><strong>调用地址</strong>：<code>https://open.u-tools.cn/baseinfo</code></p> <p><strong>请求方式</strong>：<code>get</code></p> <p><strong>Header</strong>： <code>Accept:application/json</code> 请求头中须添加此项，否则请求将失败</p> <p><strong>请求参数</strong>：</p> <table> <thead> <tr> <th>参数名</th> <th>是否必填</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>plugin_id</td> <td>是</td> <td>插件应用 ID</td> </tr> <tr> <td>access_token</td> <td>是</td> <td>uTools 用户的 access_token</td> </tr> <tr> <td>timestamp</td> <td>是</td> <td>时间戳（秒），误差需小于 10 分钟</td> </tr> <tr> <td>sign</td> <td>是</td> <td>签名</td> </tr> </tbody> </table> <h3 id="12-获取当前用户临时-access_token" tabindex="-1">1.2 获取当前用户临时 access_token <a href="#12-获取当前用户临时-access_token" class="header-anchor">#</a></h3> <p>在 uTools 客户端中调用：</p> <pre><code class="hljs lang-js"><span class="hljs-comment">// 获取用户服务端临时令牌，2 小时内有效</span>
utools.<span class="function_ hljs-title">fetchUserServerTemporaryToken</span>().<span class="function_ hljs-title">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> access_token = res.<span class="hljs-property">token</span>;
});
</code></pre> <h3 id="13-签名方法" tabindex="-1">1.3 签名方法 <a href="#13-签名方法" class="header-anchor">#</a></h3> <ol> <li>对请求参数按参数名升序排序</li> <li>对参数内容进行 <code>url_encode</code> 编码后，组合成 URL 参数形式的字符串，如：<code>access_token=aaaaaaa&amp;plugin_id=ccccc&amp;timestamp=1624329435</code></li> <li>使用 HMAC 方法对字符串生成带有密钥的哈希值，得到签名</li> </ol> <pre><code class="hljs lang-js"><span class="hljs-comment">// 以下为 php 代码演示签名过程</span>
<span class="hljs-comment">// 参数</span>
$params = [
  <span class="hljs-string">"plugin_id"</span> =&gt; <span class="hljs-string">"zueadppw"</span>, <span class="hljs-comment">// 可在开发者插件应用中获得</span>
  <span class="hljs-string">"access_token"</span> =&gt; <span class="hljs-string">"user access_token 32位"</span>,
  <span class="hljs-string">"timestamp"</span> =&gt; <span class="hljs-string">"1624329435"</span>,
];


<span class="hljs-comment">// 1. 按照键名对数组进行升序排序</span>
<span class="function_ hljs-title">ksort</span>($params);

<span class="hljs-comment">// 2. 生成 URL-encode 之后的请求字符串</span>
$str = <span class="function_ hljs-title">http_build_query</span>($params);

<span class="hljs-comment">// 3. 使用 HMAC 方法生成带有密钥的哈希值</span>
$secret = <span class="hljs-string">"your secret 32位"</span>; <span class="hljs-comment">// secret 在开发者插件应用中通过重置获取</span>
$sign = <span class="function_ hljs-title">hash_hmac</span>(<span class="hljs-string">"sha256"</span>, $str, $secret);
</code></pre> <h3 id="14-返回值" tabindex="-1">1.4 返回值 <a href="#14-返回值" class="header-anchor">#</a></h3> <p>若调用成功（http 状态码 200），将返回如下信息：</p> <pre><code class="hljs lang-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"resource"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"avatar"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://res.u-tools.cn/assets/avatars/eZCBIawAkspLw8Xg.png"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"member"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 是否 uTools 会员（0: 否，1: 是）</span>
    <span class="hljs-attr">"nickname"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"却步."</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"open_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"00a50cd81c37c4e381e8161b2d762158"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// uTools 用户 ID, 对于此插件应用不变且唯一</span>
    <span class="hljs-attr">"timestamp"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1624329616</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"sign"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"4dbf21a9d5a0f0e3906a0180522fd6393b4e91f738d57cafddf309afc6c547bb"</span> <span class="hljs-comment">// 签名算法与 1.3 相同</span>
<span class="hljs-punctuation">}</span>
</code></pre> <p>若调用失败，将返回如下信息：</p> <pre><code class="hljs lang-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"The given data was invalid."</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// message 字段始终存在</span>
  <span class="hljs-attr">"errors"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-comment">// 可能没有详细错误信息</span>
    <span class="hljs-attr">"access_token"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"access token 必须是 32 个字符。"</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre> <p>HTTP 状态码说明</p> <table> <thead> <tr> <th>http 状态码</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>200</td> <td>成功返回</td> </tr> <tr> <td>400</td> <td>客户端错误</td> </tr> <tr> <td>401</td> <td>未知用户（sign 错误，access_token 错误等）</td> </tr> <tr> <td>403</td> <td>无权限访问（access_token 过期）</td> </tr> <tr> <td>404</td> <td>未找到用户（不存在此用户或违反 uTools 相关协议被禁用）</td> </tr> <tr> <td>422</td> <td>请求的参数未通过验证</td> </tr> <tr> <td>500</td> <td>uTools 暂时无法提供服务</td> </tr> </tbody> </table> <h2 id="用户支付成功回调接口" tabindex="-1">用户支付成功回调接口 <a href="#用户支付成功回调接口" class="header-anchor">#</a></h2> <p>当用户通过 uTools 在你的插件应用内完成支付，且在开发者工具中配置了回调地址，在收到付款时，会将信息推送到配置的回调地址。</p> <h3 id="21-接口说明" tabindex="-1">2.1 接口说明 <a href="#21-接口说明" class="header-anchor">#</a></h3> <p><strong>请求方式</strong>：<code>post</code></p> <p><strong>Header</strong>：<code>contentType: application/json</code></p> <p><strong>请求参数</strong>：</p> <pre><code class="hljs lang-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"resource"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"attach"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 附加数据</span>
    <span class="hljs-attr">"body"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"会员1年"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 支付内容</span>
    <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2021-06-18 16:42:16"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 订单生成时间</span>
    <span class="hljs-attr">"goods_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"6n193s7P95p9gA13786YkwQ5oxHpVW4f"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 商品ID</span>
    <span class="hljs-attr">"open_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"a331127d654761ac91d086b942aae7b6"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// uTools 用户 ID</span>
    <span class="hljs-attr">"order_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"KMFSOZt5cMe5A0ClkdCAAyPasyXZJzP6"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// uTools 订单号</span>
    <span class="hljs-attr">"out_order_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"123456"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 外部订单号</span>
    <span class="hljs-attr">"paid_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2021-06-18 16:42:36"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 用户支付时间</span>
    <span class="hljs-attr">"pay_fee"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 支付金额（分）</span>
    <span class="hljs-attr">"plugin_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"FFFFFFFF"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"status"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 是否支付（0: 未支付，10: 已支付）</span>
    <span class="hljs-attr">"timestamp"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1624346603</span> <span class="hljs-comment">// 请求发送时间戳</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"sign"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"53e8ab69b940483abd04427fdaf2de9b5294509943df5393b7bf1913af9055fa"</span>
<span class="hljs-punctuation">}</span>
</code></pre> <h3 id="22-注意事项" tabindex="-1">2.2 注意事项 <a href="#22-注意事项" class="header-anchor">#</a></h3> <ol> <li>当处理完成后，请返回字符串 <code>SUCCESS</code></li> <li>如果返回值为其他，uTools 会延时后再次通知，最多通知 5 次，时间间隔 [15, 30, 60, 300, 600] 秒。</li> <li>通知最长等待 10 秒。</li> <li>避免消息伪造，请务必验证 sign，签名方式与获取用户基础信息接口 1.3 一致</li> </ol> <h2 id="支付订单查询接口" tabindex="-1">支付订单查询接口 <a href="#支付订单查询接口" class="header-anchor">#</a></h2> <p>此接口用于主动查询订单支付状态。</p> <h4 id="31-接口说明" tabindex="-1">3.1 接口说明 <a href="#31-接口说明" class="header-anchor">#</a></h4> <p><strong>调用地址</strong>: <code>https://open.u-tools.cn/payments/record</code></p> <p><strong>请求方式</strong>: <code>get</code></p> <p><strong>Header</strong>: <code>Accept:application/json</code> 请求头中须添加此项，否则请求将失败</p> <p>请求参数：</p> <table> <thead> <tr> <th>参数名</th> <th>是否必填</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>plugin_id</td> <td>是</td> <td>插件应用 ID</td> </tr> <tr> <td>out_order_id</td> <td>是</td> <td>第三方订单号</td> </tr> <tr> <td>timestamp</td> <td>是</td> <td>时间戳（秒），误差需小于 10 分钟</td> </tr> <tr> <td>sign</td> <td>是</td> <td>签名，与 1.3 签名方法一致</td> </tr> </tbody> </table> <h3 id="32-返回值" tabindex="-1">3.2 返回值 <a href="#32-返回值" class="header-anchor">#</a></h3> <p>若调用成功（http 状态码 200），将返回如下信息：</p> <pre><code class="hljs lang-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"resource"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"attach"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 附加数据</span>
    <span class="hljs-attr">"body"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"会员1年"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 支付内容</span>
    <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2021-06-18 16:42:16"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 订单生成时间</span>
    <span class="hljs-attr">"goods_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"6n193s7P95p9gA13786YkwQ5oxHpVW4f"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 商品ID</span>
    <span class="hljs-attr">"open_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"a331127d654761ac91d086b942aae7b6"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// uTools 用户 ID</span>
    <span class="hljs-attr">"order_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"KMFSOZt5cMe5A0ClkdCAAyPasyXZJzP6"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// uTools 订单号</span>
    <span class="hljs-attr">"out_order_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"123456"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 外部订单号</span>
    <span class="hljs-attr">"paid_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 用户支付时间</span>
    <span class="hljs-attr">"pay_fee"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 支付金额（分）</span>
    <span class="hljs-attr">"plugin_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"FFFFFFFF"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"status"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 是否支付（0: 未支付，10: 已支付）</span>
    <span class="hljs-attr">"timestamp"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1624346603</span> <span class="hljs-comment">// 请求发送时间戳</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"sign"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dbb3d05f6e794ca3b2bc2fa7ef45c3f7cd6a3b20c601b37317863b67998d535e"</span>
<span class="hljs-punctuation">}</span>
</code></pre> <p>HTTP 状态码说明</p> <table> <thead> <tr> <th>http 状态码</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>200</td> <td>成功返回</td> </tr> <tr> <td>400</td> <td>客户端错误</td> </tr> <tr> <td>401</td> <td>未知用户（sign 错误）</td> </tr> <tr> <td>403</td> <td>无权限访问（timestamp 已过期）</td> </tr> <tr> <td>404</td> <td>未找到插件应用</td> </tr> <tr> <td>422</td> <td>请求的参数未通过验证</td> </tr> <tr> <td>500</td> <td>uTools 暂时无法提供服务</td> </tr> </tbody> </table> <h2 id="创建商品接口" tabindex="-1">创建商品接口 <a href="#创建商品接口" class="header-anchor">#</a></h2> <p>此接口用于动态创建商品，主要解决不固定金额商品问题，一般为一次性使用，通过此 API 创建的商品不会出现在开发者工具的商品列表中。</p> <h4 id="31-接口说明-1" tabindex="-1">3.1 接口说明 <a href="#31-接口说明-1" class="header-anchor">#</a></h4> <p><strong>调用地址</strong>: <code>https://open.u-tools.cn/goods</code></p> <p><strong>请求方式</strong>: <code>post</code></p> <p><strong>Header</strong>: <code>Accept:application/json</code> 请求头中须添加此项，否则请求将失败</p> <p>请求参数：</p> <table> <thead> <tr> <th>参数名</th> <th>是否必填</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>plugin_id</td> <td>是</td> <td>插件应用 ID</td> </tr> <tr> <td>total_fee</td> <td>是</td> <td>商品总金额（分）</td> </tr> <tr> <td>title</td> <td>是</td> <td>商品名称</td> </tr> <tr> <td>timestamp</td> <td>是</td> <td>时间戳（秒），误差需小于 10 分钟</td> </tr> <tr> <td>sign</td> <td>是</td> <td>签名，与 1.3 签名方法一致</td> </tr> </tbody> </table> <h3 id="32-返回值-1" tabindex="-1">3.2 返回值 <a href="#32-返回值-1" class="header-anchor">#</a></h3> <p>若调用成功（http 状态码 200），将返回如下信息：</p> <pre><code class="hljs lang-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ZyxrbSpWBH360pSWG0ueYI3rKSWXMcic"</span>
<span class="hljs-punctuation">}</span>
</code></pre> <blockquote> <p>返回内容为 goods_id，可在 <a href="https://u.tools/docs/developer/api.html#openpayment-options-callback" target="_blank">openPayment</a> 中使用</p> </blockquote> <p>HTTP 状态码说明</p> <table> <thead> <tr> <th>http 状态码</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>200</td> <td>成功返回</td> </tr> <tr> <td>400</td> <td>客户端错误</td> </tr> <tr> <td>401</td> <td>未知用户（sign 错误）</td> </tr> <tr> <td>403</td> <td>无权限访问（timestamp 已过期）</td> </tr> <tr> <td>404</td> <td>未找到插件应用</td> </tr> <tr> <td>422</td> <td>请求的参数未通过验证</td> </tr> <tr> <td>500</td> <td>uTools 暂时无法提供服务</td> </tr> </tbody> </table> <hr> <div class="light-comments"> <script async="" crossorigin="anonymous" data-category="Announcements" data-category-id="DIC_kwDOMaY3rc4ChNfY" data-emit-metadata="0" data-input-position="top" data-lang="zh-CN" data-loading="lazy" data-mapping="pathname" data-reactions-enabled="1" data-repo="share121/ablog" data-repo-id="R_kgDOMaY3rQ" data-strict="0" data-theme="light" src="https://giscus.app/client.js"></script> </div> <div class="dark-comments"> <script async="" crossorigin="anonymous" data-category="Announcements" data-category-id="DIC_kwDOMaY3rc4ChNfY" data-emit-metadata="0" data-input-position="top" data-lang="zh-CN" data-loading="lazy" data-mapping="pathname" data-reactions-enabled="1" data-repo="share121/ablog" data-repo-id="R_kgDOMaY3rQ" data-strict="0" data-theme="dark" src="https://giscus.app/client.js"></script> </div> </main> <aside id="toc"><nav class="table-of-contents"><ol><li><a href="#utools-server-api">uTools Server API </a><ol><li><a href="#获取用户基础信息接口">获取用户基础信息接口 </a><ol><li><a href="#11-接口说明">1.1 接口说明 </a></li><li><a href="#12-获取当前用户临时-access_token">1.2 获取当前用户临时 access_token </a></li><li><a href="#13-签名方法">1.3 签名方法 </a></li><li><a href="#14-返回值">1.4 返回值 </a></li></ol></li><li><a href="#用户支付成功回调接口">用户支付成功回调接口 </a><ol><li><a href="#21-接口说明">2.1 接口说明 </a></li><li><a href="#22-注意事项">2.2 注意事项 </a></li></ol></li><li><a href="#支付订单查询接口">支付订单查询接口 </a><ol><li><a href="#31-接口说明">3.1 接口说明 </a></li><li><a href="#32-返回值">3.2 返回值 </a></li></ol></li><li><a href="#创建商品接口">创建商品接口 </a><ol><li><a href="#31-接口说明-1">3.1 接口说明 </a></li><li><a href="#32-返回值-1">3.2 返回值 </a></li></ol></li></ol></li></ol></nav></aside> </div> <script>function debounce(e,t){let o=null;return function(){clearTimeout(o),o=setTimeout(()=>{e.apply(this,arguments)},t)}}let lightQuery=window.matchMedia("(prefers-color-scheme:light)");function getRandomInt(e,t){e=Math.ceil(e),t=Math.floor(t);return Math.floor(Math.random()*(t-e)+e)}lightQuery.addEventListener("change",e=>{localStorage.getItem("theme")||(document.documentElement.dataset.theme=["dark","light"][+e.matches])}),window.matchMedia("(max-width: 960px)").addEventListener("change",e=>{document.querySelector("#content").classList.remove("open")}),localStorage.getItem("theme")?"dark"===localStorage.getItem("theme")&&(document.documentElement.dataset.theme="dark"):document.documentElement.dataset.theme=["dark","light"][+lightQuery.matches],location.hash&&document.querySelector(decodeURIComponent(location.hash))?document.querySelector(decodeURIComponent(location.hash)).scrollIntoView():document.querySelector("#main").scrollTop=+(localStorage.getItem("scroll-top-"+location.pathname)??0),document.querySelector("#main").style.scrollBehavior="smooth",document.querySelector("#content").scrollTop=+(localStorage.getItem("content-scroll-top")??0),document.querySelectorAll(".theme-switch").forEach(e=>e.addEventListener("click",e=>{"dark"===document.documentElement.dataset.theme?(lightQuery.matches?localStorage.removeItem("theme"):localStorage.setItem("theme","light"),document.documentElement.dataset.theme="light"):(lightQuery.matches?localStorage.setItem("theme","dark"):localStorage.removeItem("theme"),document.documentElement.dataset.theme="dark")})),document.querySelector(".random-btn").addEventListener("click",e=>{var t=document.querySelectorAll("#content a");t[getRandomInt(0,t.length)].click()}),document.querySelector("#main").addEventListener("scroll",debounce(e=>{localStorage.setItem("scroll-top-"+location.pathname,e.target.scrollTop)},100)),document.querySelector("#content").addEventListener("scroll",debounce(e=>{localStorage.setItem("content-scroll-top",e.target.scrollTop)},100)),document.querySelector(".menu-btn").addEventListener("click",()=>{document.querySelector("#content").classList.toggle("open")})</script> <script type="module"> import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";
      mermaid.initialize({
        securityLevel: "loose",
        theme: "default",
        startOnLoad: false,
      });
      await mermaid.run({ querySelector: ".mermaid-light" });
      mermaid.initialize({
        securityLevel: "loose",
        theme: "dark",
        startOnLoad: false,
      });
      await mermaid.run({ querySelector: ".mermaid-dark" });
      document
        .querySelectorAll(".mermaid")
        .forEach((e) => e.classList.add("init")); </script> </body></html>