<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ABlog</title>
    <link rel="icon" href="~/logo.svg" type="image/x-icon" />
    <link rel="stylesheet" href="~/normalize.css" />
    <link rel="stylesheet" href="~/github-markdown.css" />
    <link rel="stylesheet" href="~/github-alert.css" />
    <link rel="stylesheet" href="~/hljs.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css"
      integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="~/index.css" />
    <meta name="description" content="ABlog 是一个高性能的文档生成器" />
    <meta
      name="keywords"
      content="ABlog,文档生成器,markdown,md,html,markdown转html,md2html,blog"
    />
  </head>
  <body>
    <header id="header-box">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        class="menu-btn"
      >
        <title>菜单</title>
        <path fill="currentColor" d="M3 4h18v2H3zm0 7h18v2H3zm0 7h18v2H3z" />
      </svg>
      <h1 id="header"><a href="~/index.html">ABlog</a></h1>
      <div class="github">
        <a href="https://github.com/share121/ablog">Github</a>
      </div>
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        class="random-btn"
      >
        <title>文章漫游</title>
        <path
          fill="currentColor"
          d="M5 5v14h14V5zM3 5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2zm12.5 12a1.5 1.5 0 1 0 0-3a1.5 1.5 0 0 0 0 3M10 8.5a1.5 1.5 0 1 1-3 0a1.5 1.5 0 0 1 3 0m2 5a1.5 1.5 0 1 0 0-3a1.5 1.5 0 0 0 0 3"
        />
      </svg>
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        class="theme-switch sun"
      >
        <title>切换到深色模式</title>
        <path
          fill="currentColor"
          d="M12 18a6 6 0 1 1 0-12a6 6 0 0 1 0 12m0-2a4 4 0 1 0 0-8a4 4 0 0 0 0 8M11 1h2v3h-2zm0 19h2v3h-2zM3.515 4.929l1.414-1.414L7.05 5.636L5.636 7.05zM16.95 18.364l1.414-1.414l2.121 2.121l-1.414 1.414zm2.121-14.85l1.414 1.415l-2.121 2.121l-1.414-1.414zM5.636 16.95l1.414 1.414l-2.121 2.121l-1.414-1.414zM23 11v2h-3v-2zM4 11v2H1v-2z"
        />
      </svg>
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        class="theme-switch moon"
      >
        <title>切换到浅色模式</title>
        <path
          fill="currentColor"
          d="M10 7a7 7 0 0 0 12 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12S6.477 2 12 2h.1A6.98 6.98 0 0 0 10 7m-6 5a8 8 0 0 0 15.062 3.762A9 9 0 0 1 8.238 4.938A8 8 0 0 0 4 12"
        />
      </svg>
    </header>
    <div id="app" class="markdown-body">
      <aside id="content"></aside>
      <main id="main" class="markdown-body"></main>
      <aside id="toc"></aside>
    </div>
    <script>
      function debounce(func, delay) {
        let timer = null;
        return function () {
          clearTimeout(timer);
          timer = setTimeout(() => {
            func.apply(this, arguments);
          }, delay);
        };
      }

      const lightQuery = window.matchMedia("(prefers-color-scheme:light)");
      lightQuery.addEventListener("change", (e) => {
        if (!localStorage.getItem("theme")) {
          document.documentElement.dataset.theme = ["dark", "light"][
            +e.matches
          ];
        }
      });
      window
        .matchMedia("(max-width: 960px)")
        .addEventListener("change", (e) => {
          document.querySelector("#content").classList.remove("open");
        });

      if (!localStorage.getItem("theme")) {
        document.documentElement.dataset.theme = ["dark", "light"][
          +lightQuery.matches
        ];
      } else if (localStorage.getItem("theme") === "dark") {
        document.documentElement.dataset.theme = "dark";
      }

      /** 不包含最大值，包含最小值
       * @param {number} min
       * @param {number} max
       */
      function getRandomInt(min, max) {
        const minCeiled = Math.ceil(min);
        const maxFloored = Math.floor(max);
        return Math.floor(Math.random() * (maxFloored - minCeiled) + minCeiled);
      }

      if (
        location.hash &&
        document.querySelector(decodeURIComponent(location.hash))
      ) {
        document
          .querySelector(decodeURIComponent(location.hash))
          .scrollIntoView();
      } else {
        document.querySelector("#main").scrollTop = +(
          localStorage.getItem(`scroll-top-${location.pathname}`) ?? 0
        );
      }
      document.querySelector("#main").style.scrollBehavior = "smooth";
      document.querySelector("#content").scrollTop = +(
        localStorage.getItem("content-scroll-top") ?? 0
      );
      document.querySelectorAll(".theme-switch").forEach((e) =>
        e.addEventListener("click", (e) => {
          const theme = document.documentElement.dataset.theme;
          if (theme === "dark") {
            if (lightQuery.matches) localStorage.removeItem("theme");
            else localStorage.setItem("theme", "light");
            document.documentElement.dataset.theme = "light";
          } else {
            if (!lightQuery.matches) localStorage.removeItem("theme");
            else localStorage.setItem("theme", "dark");
            document.documentElement.dataset.theme = "dark";
          }
        })
      );
      document.querySelector(".random-btn").addEventListener("click", (e) => {
        const a = document.querySelectorAll("#content a");
        a[getRandomInt(0, a.length)].click();
      });
      document.querySelector("#main").addEventListener(
        "scroll",
        debounce((e) => {
          localStorage.setItem(
            `scroll-top-${location.pathname}`,
            e.target.scrollTop
          );
        }, 100)
      );
      document.querySelector("#content").addEventListener(
        "scroll",
        debounce((e) => {
          localStorage.setItem(`content-scroll-top`, e.target.scrollTop);
        }, 100)
      );
      document.querySelector(".menu-btn").addEventListener("click", () => {
        document.querySelector("#content").classList.toggle("open");
      });
    </script>
    <script type="module">
      import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";
      mermaid.initialize({
        securityLevel: "loose",
        theme: "default",
        startOnLoad: false,
      });
      await mermaid.run({ querySelector: ".mermaid-light" });
      mermaid.initialize({
        securityLevel: "loose",
        theme: "dark",
        startOnLoad: false,
      });
      await mermaid.run({ querySelector: ".mermaid-dark" });
      document
        .querySelectorAll(".mermaid")
        .forEach((e) => e.classList.add("init"));
    </script>
  </body>
</html>
